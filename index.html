<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nabi Hot Cakes</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.min.css">
    <style>
        :root {
            --primary: #7d3c98;
            --secondary: #9b59b6;
            --accent: #f8f4ff;
            --text-dark: #2c3e50;
            --text-light: #fff;
            --success: #7d3c98;
            --warning: #9b59b6;
            --danger: #e74c3c;
            --shadow: 0 4px 20px rgba(125, 60, 152, 0.2);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f8f4ff 0%, #ffffff 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-light);
            font-weight: 600;
            font-size: 1.5rem;
        }

        .logo-icon {
            margin-right: 10px;
        }

        .logo-symbol {
            display: flex;
            align-items: center;
        }

        .logo-circle {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .hero {
            background: linear-gradient(135deg, rgba(125, 60, 152, 0.9) 0%, rgba(155, 89, 182, 0.9) 100%);
            background-size: cover;
            background-position: center;
            color: var(--text-light);
            padding: 6rem 0;
            text-align: center;
        }

        .hero h1 {
            font-family: 'Pacifico', cursive;
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent);
            color: var(--primary);
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(125, 60, 152, 0.4);
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: var(--primary);
            font-family: 'Pacifico', cursive;
        }

        .horarios-section, .transferencia-section, .menu-section, .order-section {
            padding: 5rem 0;
        }

        .horarios-container, .transferencia-container, .order-container {
            background: white;
            padding: 3rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 900px;
            margin: 0 auto;
        }

        .horarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .horario-card {
            background: var(--accent);
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .horario-card:hover {
            transform: translateY(-5px);
        }

        .horario-card h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .punto-entrega, .info-note {
            background: #f0e6ff;
            padding: 1.5rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            margin-top: 1.5rem;
        }

        .package-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .package-card {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
        }

        .package-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(125, 60, 152, 0.3);
        }

        .package-card.selected {
            border-color: var(--primary);
            background: var(--accent);
        }

        .package-card.special {
            background: linear-gradient(135deg, #fff 0%, var(--accent) 100%);
            border: 3px dashed var(--primary);
        }

        .package-card i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .package-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .package-card p {
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            opacity: 0.8;
        }

        .price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .package-note {
            font-size: 0.9rem;
            color: var(--warning);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .select-package-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .select-package-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .ingredients-section {
            margin-top: 4rem;
        }

        .ingredients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .ingredient-category {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .ingredient-category h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .ingredient-list {
            list-style: none;
            margin-bottom: 1rem;
        }

        .ingredient-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
            color: var(--text-dark);
        }

        .ingredient-list li:last-child {
            border-bottom: none;
        }

        .selection-limit {
            font-size: 0.9rem;
            color: var(--warning);
            font-weight: 600;
            text-align: center;
            padding: 0.5rem;
            background: #f0e6ff;
            border-radius: var(--radius);
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(125, 60, 152, 0.1);
        }

        .payment-options, .delivery-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .payment-option, .delivery-option {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 1.5rem 1rem;
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-option:hover, .delivery-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .payment-option.selected, .delivery-option.selected {
            border-color: var(--primary);
            background: var(--accent);
        }

        .payment-option i {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .payment-option div {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .payment-option small {
            color: var(--text-dark);
            opacity: 0.7;
        }

        .transferencia-info {
            background: #f0e6ff;
            padding: 2rem;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            margin-top: 1rem;
        }

        .transferencia-details {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            margin: 1rem 0;
        }

        .transferencia-details p {
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .transferencia-details p:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: var(--primary);
            background: var(--accent);
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .hora-input {
            position: relative;
        }

        .hora-input small {
            display: block;
            margin-top: 0.5rem;
            color: var(--text-dark);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .price-display {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem;
            border-radius: var(--radius);
            text-align: center;
            margin: 2rem 0;
        }

        .price-display h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .total-price {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .submit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1.5rem 3rem;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: var(--shadow);
        }

        .submit-btn:hover:not(:disabled) {
            background: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(155, 89, 182, 0.4);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        footer {
            background: var(--text-dark);
            color: var(--text-light);
            padding: 3rem 0 1rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: var(--accent);
        }

        .social-links {
            display: flex;
            gap: 1rem;
        }

        .social-links a {
            color: var(--text-light);
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        .social-links a:hover {
            color: var(--accent);
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }

        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.8s ease forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--primary);
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .package-grid {
                grid-template-columns: 1fr;
            }

            .ingredients-grid {
                grid-template-columns: 1fr;
            }

            .payment-options, .delivery-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container nav-container">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <div class="logo-symbol">
                        <div class="logo-circle">N</div>
                    </div>
                </div>
                <div class="logo-symbol">
                    <span style="font-family: 'Pacifico', cursive; font-size: 1.5rem; color: white; margin-left: 10px;">Nabi</span>
                </div>
            </a>
            <nav class="nav-links">
                <a href="#menu">Menú</a>
                <a href="#horarios">Horarios</a>
                <a href="#pedido">Pedir</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1 class="fade-in">¡Los mini Hot Cakes Más Deliciosos!</h1>
            <p class="fade-in">Disfruta de mini hot cakes personalizados con tus ingredientes favoritos. Recoge en las palapas frente al Lobo.</p>
            <a href="#pedido" class="cta-button fade-in">
                <i class="fas fa-bolt"></i> Ordenar Ahora
            </a>
        </div>
    </section>

    <!-- Horarios Section -->
    <section id="horarios" class="horarios-section">
        <div class="container">
            <h2 class="section-title">Horarios para recoger</h2>
            <div class="horarios-container fade-in">
                <p>Recoge tu pedido en <strong>las palapas frente al Lobo</strong></p>
                <div class="horarios-grid" id="horarios-container">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Cargando horarios...</p>
                    </div>
                </div>
                <div class="punto-entrega">
                    📍 Punto para recoger: <strong>Palapas frente al Lobo</strong>
                </div>
            </div>
        </div>
    </section>

    <!-- Menu Section -->
    <section id="menu" class="menu-section">
        <div class="container">
            <h2 class="section-title">Nuestros Paquetes</h2>
            <div class="info-note">
                <strong>💡 Nota importante:</strong> El precio mostrado es solo del paquete base. El precio final depende de la cantidad de hot cakes que elijas.
            </div>
            <div class="package-grid" id="packages-container">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando paquetes...</p>
                </div>
            </div>

            <div class="ingredients-section fade-in">
                <h3>🍓 Ingredientes Disponibles</h3>
                <div class="ingredients-grid" id="ingredients-container">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Cargando ingredientes...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Order Section -->
    <section id="pedido" class="order-section">
        <div class="container">
            <h2 class="section-title">Personaliza Tu Pedido</h2>
            <div class="order-container fade-in">
                <form id="orderForm">
                    <div class="form-group">
                        <label for="customer"><i class="fas fa-user"></i> Tu Nombre</label>
                        <input type="text" id="customer" placeholder="Ej: Ana Martínez" required>
                    </div>

                    <div class="form-group">
                        <label for="phone"><i class="fas fa-phone"></i> Tu Número</label>
                        <input type="tel" id="phone" placeholder="+52 123 456 7890" pattern="^\+?\d{10,15}$" required>
                    </div>

                    <div class="form-group">
                        <label for="quantity"><i class="fas fa-sort-amount-up"></i> Cantidad de mini Hot Cakes</label>
                        <select id="quantity" required>
                            <option value="">Selecciona cantidad</option>
                            <!-- Las opciones se cargarán dinámicamente -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="package"><i class="fas fa-box"></i> Tipo de Paquete</label>
                        <select id="package" required>
                            <option value="">Selecciona un paquete</option>
                            <!-- Las opciones se cargarán dinámicamente -->
                        </select>
                    </div>

                    <div class="form-group hidden" id="custom-combo">
                        <label><i class="fas fa-plus"></i> Personaliza Tu Pedido</label>
                        
                        <label style="margin-top: 1rem;">Líquidos (Puedes elegir varios)</label>
                        <div class="checkbox-group" id="liquido-checkbox">
                            <!-- Los checkboxes se generarán dinámicamente -->
                        </div>

                        <label style="margin-top: 1rem;">Frutas (Elige solo 1)</label>
                        <div class="checkbox-group" id="fruta-checkbox">
                            <!-- Los checkboxes se generarán dinámicamente -->
                        </div>

                        <label style="margin-top: 1rem;">Toppings (Puedes elegir varios)</label>
                        <div class="checkbox-group" id="topping-checkbox">
                            <!-- Los checkboxes se generarán dinámicamente -->
                        </div>

                        <label style="margin-top: 1rem;">Extras (+$5 c/u)</label>
                        <div class="checkbox-group" id="extras-checkbox">
                            <!-- Los checkboxes se generarán dinámicamente -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="extras"><i class="fas fa-plus-circle"></i> Nota (opcional)</label>
                        <input type="text" id="extras" placeholder="Ej: ¿Algo más que debamos saber?">
                    </div>

                    <!-- MÉTODO DE PAGO -->
                    <div class="form-group">
                        <label><i class="fas fa-credit-card"></i> Método de Pago</label>
                        <div class="payment-options">
                            <div class="payment-option" data-value="efectivo">
                                <i class="fas fa-money-bill-wave"></i>
                                <div>Efectivo</div>
                                <small>Al recoger</small>
                            </div>
                            <div class="payment-option" data-value="transferencia">
                                <i class="fas fa-university"></i>
                                <div>Transferencia</div>
                                <small>Antes de recoger</small>
                            </div>
                        </div>
                        <input type="hidden" id="paymentMethod" required>
                    </div>

                    <!-- INFORMACIÓN DE TRANSFERENCIA -->
                    <div class="transferencia-info hidden" id="transferencia-info">
                        <h4>💳 Información para Transferencia</h4>
                        <div class="transferencia-details">
                            <p><strong>Banco:</strong> BBVA</p>
                            <p><strong>Cuenta:</strong> 1551040093</p>
                            <p><strong>Clave interbancaria:</strong> 012835015510400937</p>
                            <p><strong>Titular:</strong> Bibiana L</p>
                            <p><strong>Envía comprobante:</strong> WhatsApp 247 104 2170</p>
                        </div>
                        <div class="info-note" style="margin-top: 1rem;">
                            <strong>📋 Instrucciones:</strong><br>
                            1. Realiza la transferencia por el monto total<br>
                            2. Toma captura del comprobante<br>
                            3. Envíalo por WhatsApp al 247 104 2170<br>
                            4. Tu pedido se confirmará al recibir el comprobante
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-map-marker-alt"></i> Método de Entrega</label>
                        <div class="delivery-options">
                            <div class="delivery-option" data-value="recoger">Recoger en Lobo</div>
                            <div class="delivery-option" data-value="punto">Entrega en Punto</div>
                        </div>
                        <input type="hidden" id="delivery" required>
                    </div>

                    <div class="form-group hidden" id="punto-entrega">
                        <label for="punto"><i class="fas fa-location-dot"></i> Punto de Entrega</label>
                        <select id="punto">
                            <option value="">Selecciona un punto</option>
                            <!-- Las opciones se cargarán dinámicamente -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="dia"><i class="fas fa-calendar"></i> Día para recoger</label>
                        <select id="dia" required>
                            <option value="">Selecciona un día</option>
                            <!-- Las opciones se cargarán dinámicamente -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="hora"><i class="fas fa-clock"></i> Hora de Recoger</label>
                        <div class="hora-input">
                            <input type="time" id="hora" min="09:00" max="14:00" step="300" required>
                            <small>Selecciona una hora dentro del horario del día elegido</small>
                        </div>
                    </div>

                    <div class="price-display">
                        <h3>Total a Pagar</h3>
                        <div class="total-price" id="priceCalc">$0 MXN</div>
                        <p id="priceDetails">El precio se calculará automáticamente</p>
                    </div>

                    <button type="submit" class="submit-btn" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> Enviar Pedido
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Nabi Hot Cakes</h3>
                    <p>Los mejores hot cakes de la BUAP, hechos con amor y los ingredientes más frescos.</p>
                </div>
                <div class="footer-section">
                    <h3>Contacto</h3>
                    <p>📞 247 104 2170</p>
                    <p>📍 Recoger en palapas frente al Lobo</p>
                </div>
                <div class="footer-section">
                    <h3>Síguenos</h3>
                    <div class="social-links">
                        <a href="https://www.instagram.com/my_nabi_store" target="_blank">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://wa.me/522471042170" target="_blank">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Nabi Hot Cakes. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.all.min.js"></script>
    <script>
        // ================= CONFIGURACIÓN =================
        const CONFIG = {
            API_BASE_URL: 'https://nabi-back.onrender.com/api',
            DEFAULT_HORARIOS: {
                lunes: { activo: true, inicio: '09:00', fin: '12:00' },
                martes: { activo: true, inicio: '12:00', fin: '13:00' },
                miércoles: { activo: true, inicio: '09:00', fin: '12:00' },
                jueves: { activo: true, inicio: '12:00', fin: '13:00' },
                viernes: { activo: true, inicio: '13:00', fin: '14:00' }
            },
            DEFAULT_PRECIOS: {
                cantidad_15: 20,
                cantidad_20: 25, 
                cantidad_25: 30,
                precio_extra: 5,
                paquetes: {
                    Chocolate: 15,
                    Fitness: 10,
                    Fresita: 10,
                    Lechera: 25,
                    Gansito: 15
                }
            },
            DEFAULT_PUNTOS: [
                'Puerta de EMA 1', 'Puerta de EMA 2', 'Puerta de EMA 3', 'Puerta de EMA 4', 'Puerta de EMA 5',
                'Puerta de EMA 6', 'Puerta de EMA 7', 'Puerta de EMA 8', 'Puerta de EMA 9', 'Puerta de EMA 10',
                'Cafetería', 'Oxxo', 'Lobo'
            ]
        };

        let appState = {
            horarios: {},
            precios: {},
            puntosEntrega: [],
            ingredientes: [],
            paquetes: [],
            configCargada: false
        };

        // ================= FUNCIONES PRINCIPALES =================

        async function cargarConfiguracion() {
            try {
                console.log('🚀 Iniciando carga de configuración...');
                
                const [horarios, precios, puntos, ingredientes, paquetes] = await Promise.all([
                    fetchData('config/public/horarios', CONFIG.DEFAULT_HORARIOS),
                    fetchData('config/public/precios', CONFIG.DEFAULT_PRECIOS),
                    fetchData('config/public/puntos_entrega', CONFIG.DEFAULT_PUNTOS),
                    fetchData('ingredients/public', []),
                    fetchData('packages/public', [])
                ]);

                appState = {
                    horarios: horarios,
                    precios: precios,
                    puntosEntrega: puntos,
                    ingredientes: Array.isArray(ingredientes.ingredients) ? ingredientes.ingredients : 
                                 Array.isArray(ingredientes) ? ingredientes : [],
                    paquetes: Array.isArray(paquetes.packages) ? paquetes.packages : 
                              Array.isArray(paquetes) ? paquetes : [],
                    configCargada: true
                };

                console.log('✅ Configuración cargada:', appState);
                actualizarInterfaz();

            } catch (error) {
                console.error('❌ Error cargando configuración:', error);
                usarConfiguracionPorDefecto();
            }
        }

        async function fetchData(endpoint, defaultValue) {
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/${endpoint}`);
                if (!response.ok) throw new Error('HTTP ' + response.status);
                return await response.json();
            } catch (error) {
                console.warn(`⚠️ Usando valores por defecto para ${endpoint}`);
                return defaultValue;
            }
        }

        function usarConfiguracionPorDefecto() {
            appState = {
                horarios: CONFIG.DEFAULT_HORARIOS,
                precios: CONFIG.DEFAULT_PRECIOS,
                puntosEntrega: CONFIG.DEFAULT_PUNTOS,
                ingredientes: getIngredientesPorDefecto(),
                paquetes: getPaquetesPorDefecto(),
                configCargada: true
            };
            actualizarInterfaz();
        }

        function actualizarInterfaz() {
            actualizarHorarios();
            actualizarPrecios();
            actualizarPuntosEntrega();
            actualizarIngredientes();
            actualizarPaquetes();
            inicializarEventListeners();
        }

        function actualizarHorarios() {
            const container = document.getElementById('horarios-container');
            if (!container) return;

            let html = '';
            let horariosActivos = 0;

            Object.entries(appState.horarios).forEach(([dia, horario]) => {
                if (horario.activo) {
                    horariosActivos++;
                    html += `
                        <div class="horario-card">
                            <h4>${capitalize(dia)}</h4>
                            <p>${horario.inicio} - ${horario.fin}</p>
                        </div>
                    `;
                }
            });

            if (horariosActivos === 0) {
                html = `
                    <div class="horario-card" style="grid-column: 1 / -1;">
                        <h4>⚠️ Horarios no disponibles</h4>
                        <p>Consulta nuestros horarios más tarde</p>
                    </div>
                `;
            }

            container.innerHTML = html;
            actualizarSelectDias();
        }

        function actualizarSelectDias() {
            const select = document.getElementById('dia');
            if (!select) return;

            while (select.options.length > 1) select.remove(1);

            Object.entries(appState.horarios).forEach(([dia, horario]) => {
                if (horario.activo) {
                    const option = document.createElement('option');
                    option.value = capitalize(dia);
                    option.textContent = `${capitalize(dia)} (${horario.inicio} - ${horario.fin})`;
                    select.appendChild(option);
                }
            });
        }

        function actualizarPrecios() {
            const select = document.getElementById('quantity');
            if (!select) return;

            while (select.options.length > 1) select.remove(1);

            const cantidades = [15, 20, 25];
            cantidades.forEach(cantidad => {
                const precio = appState.precios[`cantidad_${cantidad}`] || 
                              appState.precios[cantidad] || 
                              getPrecioPorDefecto(cantidad);
                
                if (precio) {
                    const option = document.createElement('option');
                    option.value = cantidad;
                    option.textContent = `${cantidad} Mini Hot Cakes - $${precio} MXN`;
                    select.appendChild(option);
                }
            });
        }

        function actualizarPuntosEntrega() {
            const select = document.getElementById('punto');
            if (!select) return;

            while (select.options.length > 1) select.remove(1);

            appState.puntosEntrega.forEach(punto => {
                const option = document.createElement('option');
                option.value = punto;
                option.textContent = punto;
                select.appendChild(option);
            });
        }

        function actualizarIngredientes() {
            const container = document.getElementById('ingredients-container');
            if (!container) return;

            const categorias = {
                liquidos: appState.ingredientes.filter(i => i.category === 'liquidos'),
                frutas: appState.ingredientes.filter(i => i.category === 'frutas'),
                toppings: appState.ingredientes.filter(i => i.category === 'toppings'),
                extras: appState.ingredientes.filter(i => i.category === 'extras')
            };

            let html = '';

            if (appState.ingredientes.length === 0) {
                html = `
                    <div class="ingredient-category" style="grid-column: 1 / -1;">
                        <h4>⚠️ Ingredientes no disponibles</h4>
                        <p>Estamos actualizando nuestro menú</p>
                    </div>
                `;
            } else {
                Object.entries(categorias).forEach(([categoria, ingredientes]) => {
                    if (ingredientes.length > 0) {
                        html += crearCategoriaHTML(categoria, ingredientes);
                    }
                });
            }

            container.innerHTML = html;
            actualizarCheckboxesIngredientes();
        }

        function actualizarPaquetes() {
            const container = document.getElementById('packages-container');
            const select = document.getElementById('package');
            if (!container || !select) return;

            let html = '';

            // Paquetes desde la API
            appState.paquetes.forEach(paquete => {
                if (paquete.available) {
                    html += `
                        <div class="package-card" data-package="${paquete.name}" data-price="${paquete.price}">
                            <i class="${paquete.icon || 'fas fa-box'}"></i>
                            <h3>${paquete.name}</h3>
                            <p>${paquete.description}</p>
                            <div class="price">$${paquete.price} MXN</div>
                            <div class="package-note">+ costo por cantidad de hot cakes</div>
                            <button class="select-package-btn">Elegir</button>
                        </div>
                    `;
                }
            });

            // Si no hay paquetes, usar por defecto
            if (html === '') {
                getPaquetesPorDefecto().forEach(paquete => {
                    html += `
                        <div class="package-card" data-package="${paquete.name}" data-price="${paquete.price}">
                            <i class="${paquete.icon}"></i>
                            <h3>${paquete.name}</h3>
                            <p>${paquete.description}</p>
                            <div class="price">$${paquete.price} MXN</div>
                            <div class="package-note">+ costo por cantidad de hot cakes</div>
                            <button class="select-package-btn">Elegir</button>
                        </div>
                    `;
                });
            }

            // Agregar paquete personalizado
            html += `
                <div class="package-card special" data-package="personalizado" data-price="0">
                    <i class="fas fa-star"></i>
                    <h3>Especialmente Personalizar</h3>
                    <p>Crea tu propia combinación única</p>
                    <div class="price">Desde $0 MXN</div>
                    <div class="package-note">Elige tus ingredientes favoritos</div>
                    <button class="select-package-btn">Crear Mi Combinación</button>
                </div>
            `;

            container.innerHTML = html;

            // Actualizar select
            while (select.options.length > 1) select.remove(1);
            
            appState.paquetes.forEach(paquete => {
                if (paquete.available) {
                    const option = document.createElement('option');
                    option.value = paquete.name;
                    option.textContent = paquete.name;
                    select.appendChild(option);
                }
            });

            const personalizadoOption = document.createElement('option');
            personalizadoOption.value = 'personalizado';
            personalizadoOption.textContent = '✨ Personalizar Ingredientes';
            select.appendChild(personalizadoOption);

            inicializarEventListenersPaquetes();
        }

        // ================= FUNCIONES AUXILIARES =================

        function capitalize(text) {
            return text.charAt(0).toUpperCase() + text.slice(1);
        }

        function crearCategoriaHTML(categoria, ingredientes) {
            const titulos = {
                liquidos: '🥛 Líquidos',
                frutas: '🍓 Frutas', 
                toppings: '🍫 Toppings',
                extras: '✨ Extras'
            };

            const notas = {
                liquidos: 'Puedes elegir varios',
                frutas: 'Elige solo 1',
                toppings: 'Puedes elegir varios',
                extras: '+$5 c/u'
            };

            return `
                <div class="ingredient-category">
                    <h4>${titulos[categoria]}</h4>
                    <ul class="ingredient-list">
                        ${ingredientes.map(ing => `
                            <li>${ing.name} ${ing.hasExtraCost ? `(+$${ing.price})` : ''} ${!ing.available ? ' 🔴 AGOTADO' : ''}</li>
                        `).join('')}
                    </ul>
                    <div class="selection-limit">${notas[categoria]}</div>
                </div>
            `;
        }

        function actualizarCheckboxesIngredientes() {
            ['liquidos', 'frutas', 'toppings', 'extras'].forEach(categoria => {
                const container = document.getElementById(`${categoria}-checkbox`);
                if (!container) return;

                const ingredientes = appState.ingredientes.filter(i => i.category === categoria && i.available);
                
                if (ingredientes.length === 0) {
                    container.innerHTML = '<div class="checkbox-item">No hay ingredientes disponibles</div>';
                    return;
                }

                container.innerHTML = ingredientes.map(ing => `
                    <div class="checkbox-item">
                        <input type="checkbox" id="${categoria}-${ing.name}" value="${ing.name}" data-precio="${ing.price}" data-categoria="${categoria}">
                        <label for="${categoria}-${ing.name}">
                            ${ing.name} ${ing.hasExtraCost ? `(+$${ing.price})` : ''}
                        </label>
                    </div>
                `).join('');

                // Configurar comportamiento de frutas (solo 1 selección)
                if (categoria === 'frutas') {
                    const checkboxes = container.querySelectorAll('input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', function() {
                            if (this.checked) {
                                checkboxes.forEach(other => {
                                    if (other !== this) other.checked = false;
                                });
                            }
                        });
                    });
                }
            });
        }

        function getIngredientesPorDefecto() {
            return [
                { name: 'Lechera', category: 'liquidos', price: 0, available: true, hasExtraCost: false },
                { name: 'Nutella', category: 'liquidos', price: 5, available: true, hasExtraCost: true },
                { name: 'Maple', category: 'liquidos', price: 0, available: true, hasExtraCost: false },
                { name: 'Mermelada', category: 'liquidos', price: 0, available: true, hasExtraCost: false },
                { name: 'Chocolate Hersheys', category: 'liquidos', price: 5, available: true, hasExtraCost: true },
                { name: 'Plátano', category: 'frutas', price: 0, available: true, hasExtraCost: false },
                { name: 'Manzana', category: 'frutas', price: 0, available: true, hasExtraCost: false },
                { name: 'Fresa', category: 'frutas', price: 5, available: true, hasExtraCost: true },
                { name: 'Durazno', category: 'frutas', price: 0, available: true, hasExtraCost: false },
                { name: 'Granola', category: 'toppings', price: 0, available: true, hasExtraCost: false },
                { name: 'Nuez', category: 'toppings', price: 0, available: true, hasExtraCost: false },
                { name: 'Zucaritas', category: 'toppings', price: 0, available: true, hasExtraCost: false },
                { name: 'Chispas chocolate', category: 'toppings', price: 0, available: true, hasExtraCost: false },
                { name: 'Chispas colores', category: 'toppings', price: 0, available: true, hasExtraCost: false },
                { name: 'Bombones', category: 'extras', price: 5, available: true, hasExtraCost: true },
                { name: 'Oreo', category: 'extras', price: 5, available: true, hasExtraCost: true },
                { name: 'Mazapán', category: 'extras', price: 5, available: true, hasExtraCost: true },
                { name: 'Helado', category: 'extras', price: 5, available: true, hasExtraCost: true }
            ];
        }

        function getPaquetesPorDefecto() {
            return [
                {
                    name: 'Chocolate',
                    description: 'Nutella + plátano + chispas de chocolate + oreo + nuez',
                    price: 15,
                    available: true,
                    icon: 'fas fa-cookie-bite'
                },
                {
                    name: 'Fitness',
                    description: 'Granola + plátano + mermelada + nuez',
                    price: 10,
                    available: true,
                    icon: 'fas fa-dumbbell'
                },
                {
                    name: 'Fresita',
                    description: 'Fresa + bombones + chispas de colores',
                    price: 10,
                    available: true,
                    icon: 'fas fa-strawberry'
                },
                {
                    name: 'Lechera',
                    description: 'Lechera + mazapán + plátano + nuez',
                    price: 25,
                    available: true,
                    icon: 'fas fa-cow'
                },
                {
                    name: 'Gansito',
                    description: 'Chocolate + fresa + bombones + chispas',
                    price: 15,
                    available: true,
                    icon: 'fas fa-cake'
                }
            ];
        }

        function getPrecioPorDefecto(cantidad) {
            const precios = { 15: 20, 20: 25, 25: 30 };
            return precios[cantidad] || 0;
        }

        // ================= EVENT LISTENERS =================

        function inicializarEventListeners() {
            // Método de pago
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('paymentMethod').value = this.dataset.value;
                    
                    document.getElementById('transferencia-info').classList.toggle('hidden', this.dataset.value !== 'transferencia');
                });
            });

            // Método de entrega
            document.querySelectorAll('.delivery-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.delivery-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('delivery').value = this.dataset.value;
                    
                    const puntoEntrega = document.getElementById('punto-entrega');
                    const puntoSelect = document.getElementById('punto');
                    puntoEntrega.classList.toggle('hidden', this.dataset.value !== 'punto');
                    puntoSelect.required = this.dataset.value === 'punto';
                    if (this.dataset.value !== 'punto') puntoSelect.value = '';
                });
            });

            // Cambios que afectan el precio
            document.getElementById('quantity').addEventListener('change', calcularPrecio);
            document.getElementById('package').addEventListener('change', function() {
                document.getElementById('custom-combo').classList.toggle('hidden', this.value !== 'personalizado');
                calcularPrecio();
            });

            // Cambio de día para actualizar horas
            document.getElementById('dia').addEventListener('change', function() {
                const dia = this.value.toLowerCase();
                const horario = appState.horarios[dia];
                const horaInput = document.getElementById('hora');
                
                if (horario && horario.activo) {
                    horaInput.min = horario.inicio;
                    horaInput.max = horario.fin;
                    horaInput.value = horario.inicio;
                }
            });

            // Envío del formulario
            document.getElementById('orderForm').addEventListener('submit', enviarPedido);

            // Scroll suave
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });
        }

        function inicializarEventListenersPaquetes() {
            document.querySelectorAll('.package-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.package-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const package = this.dataset.package;
                    document.getElementById('package').value = package;
                    document.getElementById('custom-combo').classList.toggle('hidden', package !== 'personalizado');
                    
                    calcularPrecio();
                    document.getElementById('pedido').scrollIntoView({ behavior: 'smooth' });
                });
            });
        }

        // ================= CÁLCULO DE PRECIO =================

        function calcularPrecio() {
            const cantidad = parseInt(document.getElementById('quantity').value) || 0;
            const package = document.getElementById('package').value;
            let total = 0;
            let detalles = '';

            // Precio base por cantidad
            const precioBase = appState.precios[`cantidad_${cantidad}`] || appState.precios[cantidad] || getPrecioPorDefecto(cantidad);
            total += precioBase;
            detalles = `Base (${cantidad} hot cakes): $${precioBase}`;

            // Precio del paquete
            if (package !== 'personalizado' && package !== '') {
                const paquete = appState.paquetes.find(p => p.name === package) || 
                               getPaquetesPorDefecto().find(p => p.name === package);
                const precioPaquete = paquete ? paquete.price : 0;
                total += precioPaquete;
                detalles += ` + Paquete ${package}: $${precioPaquete}`;
            }

            // Ingredientes personalizados
            if (package === 'personalizado') {
                document.querySelectorAll('.checkbox-item input:checked').forEach(checkbox => {
                    const precio = parseFloat(checkbox.dataset.precio) || 0;
                    if (precio > 0) {
                        total += precio;
                        detalles += ` + ${checkbox.value}: $${precio}`;
                    }
                });
            }

            document.getElementById('priceCalc').textContent = `$${total} MXN`;
            document.getElementById('priceDetails').textContent = detalles;
            return total;
        }

        // ================= ENVÍO DE PEDIDO =================

        async function enviarPedido(e) {
            e.preventDefault();
            
            if (!appState.configCargada) {
                Swal.fire('Error', 'La configuración aún se está cargando. Por favor espera.', 'warning');
                return;
            }

            const formData = new FormData(e.target);
            const customer = document.getElementById('customer').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const quantity = document.getElementById('quantity').value;
            const package = document.getElementById('package').value;
            const dia = document.getElementById('dia').value;
            const hora = document.getElementById('hora').value;
            const delivery = document.getElementById('delivery').value;
            const punto = document.getElementById('punto').value;
            const paymentMethod = document.getElementById('paymentMethod').value;

            // Validaciones
            if (!customer || !phone || !quantity || !package || !dia || !hora || !delivery || !paymentMethod) {
                Swal.fire('Error', 'Por favor completa todos los campos requeridos.', 'error');
                return;
            }

            if (delivery === 'punto' && !punto) {
                Swal.fire('Error', 'Por favor selecciona un punto de entrega.', 'error');
                return;
            }

            try {
                // Deshabilitar botón
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';

                // Obtener ingredientes seleccionados
                const ingredientesSeleccionados = {
                    liquidos: Array.from(document.querySelectorAll('#liquido-checkbox input:checked')).map(cb => cb.value),
                    frutas: Array.from(document.querySelectorAll('#fruta-checkbox input:checked')).map(cb => cb.value),
                    toppings: Array.from(document.querySelectorAll('#topping-checkbox input:checked')).map(cb => cb.value),
                    extras: Array.from(document.querySelectorAll('#extras-checkbox input:checked')).map(cb => cb.value)
                };

                // Calcular precio final
                const total = calcularPrecio();

                // Datos del pedido
                const pedidoData = {
                    customer,
                    phone,
                    quantity: parseInt(quantity),
                    package,
                    liquidos: package === 'personalizado' ? ingredientesSeleccionados.liquidos : [],
                    frutas: package === 'personalizado' ? ingredientesSeleccionados.frutas : [],
                    toppings: package === 'personalizado' ? ingredientesSeleccionados.toppings : [],
                    extras: package === 'personalizado' ? ingredientesSeleccionados.extras : [],
                    delivery,
                    punto: delivery === 'punto' ? punto : 'Palapas frente al Lobo',
                    dia,
                    hora,
                    total,
                    paymentMethod,
                    paymentConfirmed: paymentMethod === 'efectivo',
                    notas: document.getElementById('extras').value.trim() || ''
                };

                // Enviar pedido
                const response = await fetch(`${CONFIG.API_BASE_URL}/pedidos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(pedidoData)
                });

                if (!response.ok) throw new Error('Error al enviar pedido');

                const result = await response.json();

                // Mostrar éxito
                await Swal.fire({
                    title: '¡Pedido Enviado! 🎉',
                    html: `
                        <div style="text-align: left;">
                            <strong>Recoge en:</strong> ${pedidoData.punto}<br>
                            <strong>Fecha:</strong> ${dia} a las ${hora}<br>
                            <strong>Total:</strong> $${total} MXN<br>
                            ${paymentMethod === 'transferencia' ? `
                                <br><strong>💳 Para transferencia:</strong><br>
                                Realiza la transferencia y envía comprobante al WhatsApp
                            ` : '<br><strong>💰 Pago en efectivo al recoger</strong>'}
                        </div>
                    `,
                    icon: 'success',
                    confirmButtonColor: '#7d3c98'
                });

                // Limpiar formulario
                e.target.reset();
                document.querySelectorAll('.package-card').forEach(card => card.classList.remove('selected'));
                document.querySelectorAll('.checkbox-item input').forEach(checkbox => checkbox.checked = false);
                document.querySelectorAll('.payment-option, .delivery-option').forEach(opt => opt.classList.remove('selected'));
                document.getElementById('custom-combo').classList.add('hidden');
                document.getElementById('punto-entrega').classList.add('hidden');
                document.getElementById('transferencia-info').classList.add('hidden');
                document.getElementById('priceCalc').textContent = '$0 MXN';
                document.getElementById('priceDetails').textContent = 'El precio se calculará automáticamente';

            } catch (error) {
                console.error('Error enviando pedido:', error);
                Swal.fire('Error', 'No se pudo enviar el pedido. Intenta nuevamente.', 'error');
            } finally {
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar Pedido';
            }
        }

        // ================= INICIALIZACIÓN =================

        document.addEventListener('DOMContentLoaded', function() {
            cargarConfiguracion();
        });
    </script>
</body>
</html>